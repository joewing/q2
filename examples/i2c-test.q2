
.include examples/zeropage.q2

; Simulate reading 16 bytes

  .org  0x800

  lea   =10
loop:
  add   =neg1
  sta   =x9

  jal   @#i2c_start

  ; Control
  lea   =1
  sta   =x0
  jal   @#i2c_write

  ; Address high
  lea   =2
  sta   =x0
  jal   @#i2c_write

  ; Address low
  lda   =x9
  sta   =x0
  jal   @#i2c_write

  ; Data high
  jal   @#i2c_read

  ; Data low
  jal   @#i2c_read

  jal   @#i2c_stop

  lda   =x9
  jfc   loop

  jmp   $

.include examples/i2c.q2
